# Tasks: AI Rejection Feedback

**Input**: Design documents from `/specs/022-ai-rejection-feedback/`
**Prerequisites**: [plan.md](file:///Users/raul.alzate/Documents/maestria/dev-prescreening/specs/022-ai-rejection-feedback/plan.md), [spec.md](file:///Users/raul.alzate/Documents/maestria/dev-prescreening/specs/022-ai-rejection-feedback/spec.md), [research.md](file:///Users/raul.alzate/Documents/maestria/dev-prescreening/specs/022-ai-rejection-feedback/research.md), [data-model.md](file:///Users/raul.alzate/Documents/maestria/dev-prescreening/specs/022-ai-rejection-feedback/data-model.md), [contracts/rejection.md](file:///Users/raul.alzate/Documents/maestria/dev-prescreening/specs/022-ai-rejection-feedback/contracts/rejection.md)

**Organization**: Tasks are grouped by user story to enable independent implementation and testing of each story.

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Project initialization and basic structure

- [x] T001 Verify all spec and plan documents are synced in `/specs/022-ai-rejection-feedback/`
- [x] T002 [P] Verify `react-markdown` availability in `package.json`

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Core AI logic that MUST be complete before ANY user story can be implemented

- [x] T003 Create `lib/ia/rejectionFeedbackGenerator.ts` extending `BaseGenerator`
- [x] T004 [P] Define Zod schemas for `RejectionFeedbackInput` (gaps, requirements context) in `lib/ia/rejectionFeedbackGenerator.ts`
- [x] T005 Implement the mentoring prompt template in `lib/ia/rejectionFeedbackGenerator.ts` ensuring friendly tone

**Checkpoint**: Foundation ready - AI rejection logic is defined.

---

## Phase 3: User Story 1 - Actionable Recommendations (Priority: P1) ðŸŽ¯ MVP

**Goal**: Candidate receives personalised mentoring feedback after rejection.

**Independent Test**: Complete an evaluation that results in a rejection. Verify the dashboard display a "Feedback Detallado" section with specific bullet points generated by AI.

### Implementation for User Story 1

- [x] T006 Update `app/api/evaluation/route.ts` failure branch to call `rejectionFeedbackGenerator`
- [x] T007 Update `users` table `interview_feedback` column via `db.execute` in failure branch of `app/api/evaluation/route.ts`
- [x] T008 [P] [US1] Integration: Use `ReactMarkdown` in `app/(protected)/page.tsx` within the feedback section to render AI results correctly
- [x] T009 [US1] Add basic error handling for AI generation failure

**Checkpoint**: User Story 1 is functional - candidates see AI feedback.

---

## Phase 4: User Story 2 - Requirement-Specific Feedback (Priority: P2)

**Goal**: AI feedback aligns precisely with the requirement profile and candidate gaps.

**Independent Test**: Failed evaluations for different requirements (e.g., Frontend vs Backend) produce distinct, role-relevant skills in the recommendations.

### Implementation for User Story 2

- [x] T010 [P] [US2] Enhance prompt in `lib/ia/rejectionFeedbackGenerator.ts` to explicitly incorporate the `opportunityTitle` and requirement description
- [x] T011 [US2] Refine gap analysis mapping to provide more context to the AI (not just skill names, but required vs got levels)
- [x] T012 [US2] Manual verification: Compare feedback for 2 different requirements to ensure relevance

**Checkpoint**: AI feedback is highly contextual and tailored to the job profile.

---

## Phase 5: Polish & Cross-Cutting Concerns

**Purpose**: Improvements that affect multiple user stories

- [x] T013 Implement "mentoring" status tracking in `evaluation_result` JSON within `app/api/evaluation/route.ts`
- [x] T014 [P] Run `npm run lint` and `npm test` across the project
- [x] T015 Run `quickstart.md` validation scenarios

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies.
- **Foundational (Phase 2)**: Depends on Phase 1.
- **User Stories (Phase 3+)**: Depend on Foundational (Phase 2).
- **Polish (Phase 5)**: Depends on Phase 3 and 4.

### Execution Order
T001 â†’ T002 â†’ T003 â†’ T004 â†’ T005 â†’ T006 â†’ T007 â†’ T008 â†’ T009 â†’ T010 â†’ T011 â†’ T012 â†’ T013 â†’ T014 â†’ T015

### Parallel Opportunities
- T002 (Setup)
- T004 (Foundational)
- T008 (US1 Integration)
- T010 (US2 Context)
- T014 (Final check)
