# Feature Specification: AI Rejection Feedback

**Feature Branch**: `022-ai-rejection-feedback`  
**Created**: 2026-02-18  
**Status**: Draft  
**Input**: User description: "complementar el feedback con una analisis de IA cuando se rechaza por pre-screening, se debe utilizar los resutados para especificar este feedback amistosos, el objetivo es que el canidato se lleve una manera de recomendaciones para mejorar sus habilidades necesartias para ese requerimiento"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Candidate Receives Actionable Recommendations (Priority: P1)

As a candidate who failed the pre-screening evaluation, I want to receive personalized and friendly feedback generated by AI, so that I can understand my areas for improvement and know which specific skills to develop for the requirement I applied to.

**Why this priority**: Essential for fulfilling the user's request. It provides immediate value to the candidate even in case of rejection, improving the employer brand and the candidate's professional growth.

**Independent Test**: A candidate fails a pre-screening. The results page displays a section titled "Recommendations for Your Growth" with 3-5 specific, friendly advice points related to the requirement profile.

**Acceptance Scenarios**:

1. **Given** a candidate has just failed the pre-screening, **When** they view their results, **Then** the system MUST display an AI-generated section with friendly recommendations for improvement.
2. **Given** the AI feedback section, **When** the candidate reads the content, **Then** the tone MUST be encouraging and professional (no harsh rejection language).

---

### User Story 2 - Requirement-Specific Feedback (Priority: P2)

As an administrator, I want the AI to analyze the candidate's answers against the specific requirement profile, so that the feedback is relevant and not a generic rejection message.

**Why this priority**: Ensures the feedback is actually useful and aligned with the business context of the opening.

**Independent Test**: Compare feedback for two different requirements (e.g., Frontend vs backend). Verify that the AI emphasizes different technical skills (e.g., React hooks vs SQL optimization) based on the requirement profile.

**Acceptance Scenarios**:

1. **Given** a candidate applied for "Senior React Developer", **When** they are rejected, **Then** the AI recommendations MUST focus on frontend technologies and best practices specified in that requirement.
2. **Given** the evaluation results, **When** the AI analyzes them, **Then** it MUST identify specific gaps (e.g., "Deepen your understanding of state management") rather than just saying "You failed".

---

### Edge Cases

- **Incomplete Evaluations**: If a candidate only answered one question before being rejected (e.g., absolute requirement mismatch), the AI should still provide a polite summary of why the profile didn't fit.
- **AI Service Downtime**: If the Genkit/AI service is unreachable, the system MUST fallback to a standard friendly rejection message without the personalized recommendations.
- **Garbage Input**: If the candidate provided nonsensical answers, the AI should remain professional and focus on the requirement's expectations.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: System MUST trigger an AI analysis when a candidate's pre-screening result status is `valid: false`.
- **FR-002**: System MUST use the requirement profile description and the candidate's answers as context for the AI prompt.
- **FR-003**: The AI prompt MUST explicitly command a "friendly, encouraging, and mentoring" tone.
- **FR-004**: System MUST present the recommendations as a list of actionable items.
- **FR-005**: System MUST persist the generated AI feedback in the database associated with the candidate's evaluation record.
- **FR-006**: System MUST support a fallback mechanism to a generic rejection message if AI generation fails.

### Key Entities *(include if feature involves data)*

- **AIRecommendation**: Represents the feedback generated for a candidate. Attributes: `recommendation_text` (markdown), `created_at`, `status` (success/fallback).
- **EvaluationRecord**: Existing entity, now related to 1 `AIRecommendation`.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 100% of rejected candidates receive personalized feedback (unless service is down).
- **SC-002**: AI recommendations are generated and displayed in under 3 seconds after the evaluation is finished.
- **SC-003**: Feedback content MUST contain at least 2 specific mentions of skills or technologies from the requirement profile.
- **SC-004**: System maintains a " mentorial" tone throughout the feedback as verified by random sampling.
